@model ArandanoIRT.Web._1_Application.DTOs.Crops.ICropFormData

<div asp-validation-summary="ModelOnly" class="text-danger" role="alert"></div>

<h5 class="form-section-title">Información General</h5>
<div class="mb-3">
    <label asp-for="Name" class="form-label">
        Nombre del Cultivo
        <span class="tooltip-icon" data-tooltip="Nombre identificativo para el cultivo (ej. 'Finca La Esperanza - Lote 1').">?</span>
    </label>
    <input asp-for="Name" class="form-control" />
    <span asp-validation-for="Name" class="text-danger"></span>
</div>
<div class="mb-3">
    <label asp-for="Address" class="form-label">
        Dirección
        <span class="tooltip-icon" data-tooltip="Dirección física donde se encuentra el cultivo.">?</span>
    </label>
    <input asp-for="Address" class="form-control" />
    <span asp-validation-for="Address" class="text-danger"></span>
</div>
<input type="hidden" asp-for="CityName" />

<div class="row">
    <div class="col-md-4 mb-3">
        <label for="country-select" class="form-label">País</label>
        <select id="country-select" class="form-select" disabled>
            <option selected>Colombia</option>
        </select>
    </div>
    <div class="col-md-4 mb-3">
        <label for="department-select" class="form-label">Departamento</label>
        <select id="department-select" class="form-select">
            <option value="">Seleccione un departamento...</option>
        </select>
    </div>
    <div class="col-md-4 mb-3">
        <label for="city-select" class="form-label">
            Ciudad / Municipio
            <span class="tooltip-icon" data-tooltip="Selecciona el departamento primero para habilitar esta lista.">?</span>
        </label>
        <select id="city-select" class="form-select" disabled>
            <option value="">Seleccione una ciudad...</option>
        </select>
    </div>
</div>
<span asp-validation-for="CityName" class="text-danger"></span>

@if (Model.CropSettings != null)
{
    <hr class="my-4"/>
    <h5 class="form-section-title">Parámetros y Umbrales del Cultivo</h5>

    <div class="form-group-container">
        <fieldset class="border p-3">
            <legend class="w-auto px-2 fs-6">Análisis (CWSI)</legend>
            <div class="row">
                <div class="col-12 mb-3">
                    <label asp-for="CropSettings.AnalysisParameters.CwsiThresholdIncipient" class="form-label">
                        Umbral de Estrés Incipiente
                        <span class="tooltip-icon" data-tooltip="Valor CWSI (0.0 - 1.0) a partir del cual se considera estrés leve.">?</span>
                    </label>
                    <input type="number" step="0.01" min="0" max="1" asp-for="CropSettings.AnalysisParameters.CwsiThresholdIncipient" class="form-control" />
                    <span asp-validation-for="CropSettings.AnalysisParameters.CwsiThresholdIncipient" class="text-danger"></span>
                </div>
                <div class="col-12 mb-3">
                    <label asp-for="CropSettings.AnalysisParameters.CwsiThresholdCritical" class="form-label">
                        Umbral de Estrés Crítico
                        <span class="tooltip-icon" data-tooltip="Valor CWSI (0.0 - 1.0) a partir del cual se considera estrés severo.">?</span>
                    </label>
                    <input type="number" step="0.01" min="0" max="1" asp-for="CropSettings.AnalysisParameters.CwsiThresholdCritical" class="form-control" />
                    <span asp-validation-for="CropSettings.AnalysisParameters.CwsiThresholdCritical" class="text-danger"></span>
                </div>
                <div class="col-12 mb-3">
                    <label asp-for="CropSettings.AnalysisParameters.AnalysisWindowStartHour" class="form-label">
                        Hora de Inicio (24h)
                        <span class="tooltip-icon" data-tooltip="Hora del día (0-23) a partir de la cual se considerarán los datos para el análisis.">?</span>
                    </label>
                    <input type="number" min="0" max="23" asp-for="CropSettings.AnalysisParameters.AnalysisWindowStartHour" class="form-control" />
                    <span asp-validation-for="CropSettings.AnalysisParameters.AnalysisWindowStartHour" class="text-danger"></span>
                </div>
                <div class="col-12 mb-3">
                    <label asp-for="CropSettings.AnalysisParameters.AnalysisWindowEndHour" class="form-label">
                        Hora de Fin (24h)
                        <span class="tooltip-icon" data-tooltip="Hora del día (0-23) hasta la cual se considerarán los datos para el análisis.">?</span>
                    </label>
                    <input type="number" min="0" max="23" asp-for="CropSettings.AnalysisParameters.AnalysisWindowEndHour" class="form-control" />
                    <span asp-validation-for="CropSettings.AnalysisParameters.AnalysisWindowEndHour" class="text-danger"></span>
                </div>
                <div class="col-12 mb-3">
                    <label asp-for="CropSettings.AnalysisParameters.LightIntensityThreshold" class="form-label">
                        Umbral de Luz (lux)
                        <span class="tooltip-icon" data-tooltip="Valor mínimo de intensidad de luz (en lux) para que los datos térmicos sean considerados válidos.">?</span>
                    </label>
                    <input type="number" min="0" asp-for="CropSettings.AnalysisParameters.LightIntensityThreshold" class="form-control" />
                    <span asp-validation-for="CropSettings.AnalysisParameters.LightIntensityThreshold" class="text-danger"></span>
                </div>
            </div>
        </fieldset>

        <fieldset class="border p-3">
            <legend class="w-auto px-2 fs-6">Anomalías Nocturnas</legend>
            <div class="row">
                <div class="col-12 mb-3">
                    <label asp-for="CropSettings.AnomalyParameters.DeltaTThreshold" class="form-label">
                        Umbral Delta T (°C)
                        <span class="tooltip-icon" data-tooltip="Diferencia de temperatura mínima entre la planta y el ambiente para ser considerada una anomalía.">?</span>
                    </label>
                    <input type="number" step="0.1" asp-for="CropSettings.AnomalyParameters.DeltaTThreshold" class="form-control" />
                    <span asp-validation-for="CropSettings.AnomalyParameters.DeltaTThreshold" class="text-danger"></span>
                </div>
                <div class="col-12 mb-3">
                    <label asp-for="CropSettings.AnomalyParameters.DurationMinutes" class="form-label">
                        Duración Mínima (min)
                        <span class="tooltip-icon" data-tooltip="Tiempo mínimo en minutos que una anomalía debe persistir para ser considerada una alerta. No puede ser negativo.">?</span>
                    </label>
                    <input type="number" min="1" asp-for="CropSettings.AnomalyParameters.DurationMinutes" class="form-control" />
                    <span asp-validation-for="CropSettings.AnomalyParameters.DurationMinutes" class="text-danger"></span>
                </div>
            </div>
        </fieldset>

        <fieldset class="border p-3">
            <legend class="w-auto px-2 fs-6">Calibración</legend>
            <div class="row">
                <div class="col-12 mb-3">
                    <label asp-for="CropSettings.CalibrationReminder.ReminderIntervalMonths" class="form-label">
                        Intervalo de Recordatorio (meses)
                        <span class="tooltip-icon" data-tooltip="Cada cuántos meses se enviará un recordatorio para calibrar los dispositivos asociados a este cultivo.">?</span>
                    </label>
                    <input type="number" min="1" asp-for="CropSettings.CalibrationReminder.ReminderIntervalMonths" class="form-control" />
                    <span asp-validation-for="CropSettings.CalibrationReminder.ReminderIntervalMonths" class="text-danger"></span>
                </div>
            </div>
        </fieldset>
    </div>
}
